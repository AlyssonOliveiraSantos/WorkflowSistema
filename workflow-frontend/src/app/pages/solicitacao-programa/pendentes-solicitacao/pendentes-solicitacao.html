<div class="table-container criar-fundo">
  <h2>Solicitações Pendentes</h2>

  <table datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger" class="row-border hover">
    <thead>
      <tr>
        <th>ID</th>
        <th>Usuário</th>
        <th>Programa</th>
        <th>Permissão</th>
        <th>Finalizado</th>
        <th>Data</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let s of solicitacoes">
        <td>{{ s.id }}</td>
        <td>{{ s.usuarioWorkflowNome }}</td>
        <td>{{ s.programaNome }}</td>
        <td>{{ s.permissao }}</td>
        <td>{{ s.finalizado ? 'Sim' : 'Não' }}</td>
        <td>{{ s.dataSolicitacao | date:'dd/MM/yyyy' }}</td>
        <td>
          <button class="btn-detalhes" (click)="abrirDetalhes(s)">Detalhes</button>
          <button class="btn-aprovar" (click)="abrirDecisao(s, true)">Aprovar</button>
          <button class="btn-recusar" (click)="abrirDecisao(s, false)">Recusar</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>


<div class="modal" *ngIf="detalheSelecionado && !decisaoModal">
  <div class="modal-content">
    <span class="close" (click)="fecharDetalhes()">×</span>

    <p><strong>ID:</strong> {{ detalheSelecionado.id }}</p>
    <p><strong>Solicitante:</strong> {{ detalheSelecionado.solicitanteWorkflowNome }}</p>
    <p><strong>Usuário:</strong> {{ detalheSelecionado.usuarioWorkflowNome }}</p>
    <p><strong>Programa:</strong> {{ detalheSelecionado.programaNome }}</p>
    <p><strong>Permissão:</strong> {{ detalheSelecionado.permissao }}</p>
    <p><strong>Finalizado:</strong> {{ detalheSelecionado.finalizado ? 'Sim' : 'Não' }}</p>
    <p><strong>Data da Solicitação:</strong> {{ detalheSelecionado.dataSolicitacao | date:'dd/MM/yyyy HH:mm' }}</p>
    <p><strong>Observação do Solicitante:</strong> {{ detalheSelecionado.observacaoSolicitante }}</p>
    <hr />
    <p><strong>Aprovado pelo Gerente:</strong> {{ detalheSelecionado.aprovadoGerente ? 'Sim' : 'Não' }}</p>
    <p><strong>Observação do Gerente:</strong> {{ detalheSelecionado.observacaoGerente }}</p>
    <p><strong>Data Aprovação Gerente:</strong> {{ detalheSelecionado.dataAprovacaoGerente | date:'dd/MM/yyyy HH:mm' }}</p>
    <hr />
    <p><strong>Aprovado pelo Responsável Programa:</strong> {{ detalheSelecionado.aprovadoResponsavelPrograma ? 'Sim' : 'Não' }}</p>
    <p><strong>Observação do Responsável Programa:</strong> {{ detalheSelecionado.observacaoResponsavelPrograma }}</p>
    <p><strong>Data Aprovação Responsável Programa:</strong> {{ detalheSelecionado.dataAprovacaoResponsavelPrograma | date:'dd/MM/yyyy HH:mm' }}</p>
    <hr />
    <p><strong>Aprovado pelo TI:</strong> {{ detalheSelecionado.aprovadoTI ? 'Sim' : 'Não' }}</p>
    <p><strong>Observação do TI:</strong> {{ detalheSelecionado.observacaoTI }}</p>
    <p><strong>Data Aprovação TI:</strong> {{ detalheSelecionado.dataAprovacaoTI | date:'dd/MM/yyyy HH:mm' }}</p>
  </div>
</div>


<div class="modal" *ngIf="decisaoModal">
  <div class="modal-content">
    <span class="close" (click)="fecharDecisao()">×</span>
    <h3>{{ decisaoAprovada ? 'Aprovar' : 'Recusar' }} Solicitação</h3>
    <textarea [(ngModel)]="observacao" placeholder="Escreva sua observação..."></textarea>
<button class="confirmar" 
        *ngIf="detalheSelecionado"
        (click)="confirmarDecisaoDireta(detalheSelecionado!, decisaoAprovada)">
  Confirmar
</button>
  </div>
</div>
